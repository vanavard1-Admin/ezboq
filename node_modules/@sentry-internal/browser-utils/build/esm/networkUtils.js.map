{"version":3,"file":"networkUtils.js","sources":["../../src/networkUtils.ts"],"sourcesContent":["import { debug } from '@sentry/core';\nimport { DEBUG_BUILD } from './debug-build';\nimport type { NetworkMetaWarning } from './types';\n\n/**\n * Serializes FormData.\n *\n * This is a bit simplified, but gives us a decent estimate.\n * This converts e.g. { name: 'Anne Smith', age: 13 } to 'name=Anne+Smith&age=13'.\n *\n */\nexport function serializeFormData(formData: FormData): string {\n  // @ts-expect-error passing FormData to URLSearchParams actually works\n  return new URLSearchParams(formData).toString();\n}\n\n/** Get the string representation of a body. */\nexport function getBodyString(body: unknown, _debug: typeof debug = debug): [string | undefined, NetworkMetaWarning?] {\n  try {\n    if (typeof body === 'string') {\n      return [body];\n    }\n\n    if (body instanceof URLSearchParams) {\n      return [body.toString()];\n    }\n\n    if (body instanceof FormData) {\n      return [serializeFormData(body)];\n    }\n\n    if (!body) {\n      return [undefined];\n    }\n  } catch (error) {\n    DEBUG_BUILD && _debug.error(error, 'Failed to serialize body', body);\n    return [undefined, 'BODY_PARSE_ERROR'];\n  }\n\n  DEBUG_BUILD && _debug.log('Skipping network body because of body type', body);\n\n  return [undefined, 'UNPARSEABLE_BODY_TYPE'];\n}\n\n/**\n * Parses the fetch arguments to extract the request payload.\n *\n * We only support getting the body from the fetch options.\n */\nexport function getFetchRequestArgBody(fetchArgs: unknown[] = []): RequestInit['body'] | undefined {\n  if (fetchArgs.length !== 2 || typeof fetchArgs[1] !== 'object') {\n    return undefined;\n  }\n\n  return (fetchArgs[1] as RequestInit).body;\n}\n\n/**\n * Parses XMLHttpRequest response headers into a Record.\n * Extracted from replay internals to be reusable.\n */\nexport function parseXhrResponseHeaders(xhr: XMLHttpRequest): Record<string, string> {\n  let headers: string | undefined;\n  try {\n    headers = xhr.getAllResponseHeaders();\n  } catch (error) {\n    DEBUG_BUILD && debug.error(error, 'Failed to get xhr response headers', xhr);\n    return {};\n  }\n\n  if (!headers) {\n    return {};\n  }\n\n  return headers.split('\\r\\n').reduce((acc: Record<string, string>, line: string) => {\n    const [key, value] = line.split(': ') as [string, string | undefined];\n    if (value) {\n      acc[key.toLowerCase()] = value;\n    }\n    return acc;\n  }, {});\n}\n"],"names":[],"mappings":";;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,iBAAiB,CAAC,QAAQ,EAAoB;AAC9D;AACA,EAAE,OAAO,IAAI,eAAe,CAAC,QAAQ,CAAC,CAAC,QAAQ,EAAE;AACjD;;AAEA;AACO,SAAS,aAAa,CAAC,IAAI,EAAW,MAAM,GAAiB,KAAK,EAA6C;AACtH,EAAE,IAAI;AACN,IAAI,IAAI,OAAO,IAAA,KAAS,QAAQ,EAAE;AAClC,MAAM,OAAO,CAAC,IAAI,CAAC;AACnB;;AAEA,IAAI,IAAI,IAAA,YAAgB,eAAe,EAAE;AACzC,MAAM,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;AAC9B;;AAEA,IAAI,IAAI,IAAA,YAAgB,QAAQ,EAAE;AAClC,MAAM,OAAO,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;AACtC;;AAEA,IAAI,IAAI,CAAC,IAAI,EAAE;AACf,MAAM,OAAO,CAAC,SAAS,CAAC;AACxB;AACA,GAAE,CAAE,OAAO,KAAK,EAAE;AAClB,IAAI,WAAA,IAAe,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE,0BAA0B,EAAE,IAAI,CAAC;AACxE,IAAI,OAAO,CAAC,SAAS,EAAE,kBAAkB,CAAC;AAC1C;;AAEA,EAAE,WAAA,IAAe,MAAM,CAAC,GAAG,CAAC,4CAA4C,EAAE,IAAI,CAAC;;AAE/E,EAAE,OAAO,CAAC,SAAS,EAAE,uBAAuB,CAAC;AAC7C;;AAEA;AACA;AACA;AACA;AACA;AACO,SAAS,sBAAsB,CAAC,SAAS,GAAc,EAAE,EAAmC;AACnG,EAAE,IAAI,SAAS,CAAC,WAAW,CAAA,IAAK,OAAO,SAAS,CAAC,CAAC,CAAA,KAAM,QAAQ,EAAE;AAClE,IAAI,OAAO,SAAS;AACpB;;AAEA,EAAE,OAAO,CAAC,SAAS,CAAC,CAAC,CAAA,GAAkB,IAAI;AAC3C;;AAEA;AACA;AACA;AACA;AACO,SAAS,uBAAuB,CAAC,GAAG,EAA0C;AACrF,EAAE,IAAI,OAAO;AACb,EAAE,IAAI;AACN,IAAI,UAAU,GAAG,CAAC,qBAAqB,EAAE;AACzC,GAAE,CAAE,OAAO,KAAK,EAAE;AAClB,IAAI,WAAA,IAAe,KAAK,CAAC,KAAK,CAAC,KAAK,EAAE,oCAAoC,EAAE,GAAG,CAAC;AAChF,IAAI,OAAO,EAAE;AACb;;AAEA,EAAE,IAAI,CAAC,OAAO,EAAE;AAChB,IAAI,OAAO,EAAE;AACb;;AAEA,EAAE,OAAO,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,CAAC,GAAG,EAA0B,IAAI,KAAa;AACrF,IAAI,MAAM,CAAC,GAAG,EAAE,KAAK,CAAA,GAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAA;AACxC,IAAI,IAAI,KAAK,EAAE;AACf,MAAM,GAAG,CAAC,GAAG,CAAC,WAAW,EAAE,CAAA,GAAI,KAAK;AACpC;AACA,IAAI,OAAO,GAAG;AACd,GAAG,EAAE,EAAE,CAAC;AACR;;;;"}