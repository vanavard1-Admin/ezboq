# ЁЯОп р╕гр╕░р╕Ър╕Ъ Affiliate / Referral Code

## ЁЯУМ р╕ар╕▓р╕Юр╕гр╕зр╕б

р╕гр╕░р╕Ър╕Ър╕кр╣Ир╕зр╕Щр╕ер╕Фр╣Бр╕ер╕░ Affiliate Marketing р╣Бр╕Ър╕Ъ **Win-Win-Win**:
- ЁЯСе **р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й** р╣Др╕Фр╣Йр╕кр╣Ир╕зр╕Щр╕ер╕Фр╕Юр╕┤р╣Ар╕ир╕й (10-25%)
- ЁЯТ░ **Influencer/Partner** р╣Др╕Фр╣Йр╕Др╕нр╕бр╕бр╕┤р╕Кр╕Кр╕▒р╣Ир╕Щ (20-30%)
- ЁЯУИ **р╣Ар╕гр╕▓** р╣Др╕Фр╣Йр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Ар╕Юр╕┤р╣Ир╕б р╕Ьр╣Ир╕▓р╕Щр╕Бр╕▓р╕гр╕Хр╕ер╕▓р╕Фр╣Бр╕Ър╕Ъ Affiliate

## тЬи р╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣М

### 1. р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й
- тЬЕ р╣Гр╕кр╣Ир╕гр╕лр╕▒р╕кр╕кр╣Ир╕зр╕Щр╕ер╕Фр╣Гр╕Щр╕лр╕Щр╣Йр╕▓ Membership р╕Бр╣Ир╕нр╕Щр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ
- тЬЕ р╕гр╕░р╕Ър╕Ър╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╣Бр╕Ър╕Ъ Real-time
- тЬЕ р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕╣р╣Йр╣Бр╕Щр╕░р╕Щр╕│р╣Бр╕ер╕░р╕кр╣Ир╕зр╕Щр╕ер╕Фр╕Чр╕╡р╣Ир╣Др╕Фр╣Й
- тЬЕ р╕Др╕│р╕Щр╕зр╕Ур╕гр╕▓р╕Др╕▓р╕лр╕ер╕▒р╕Зр╕лр╕▒р╕Бр╕кр╣Ир╕зр╕Щр╕ер╕Фр╕Чр╕▒р╕Щр╕Чр╕╡
- тЬЕ р╕кр╕▓р╕бр╕▓р╕гр╕Цр╕вр╕Бр╣Ар╕ер╕┤р╕Бр╣Бр╕ер╕░р╣Гр╕кр╣Ир╕гр╕лр╕▒р╕кр╣Гр╕лр╕бр╣Ир╣Др╕Фр╣Й

### 2. р╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕гр╕лр╕▒р╕кр╕кр╣Ир╕зр╕Щр╕ер╕Ф

#### System Promo Codes (р╣Др╕бр╣Ир╕бр╕╡р╕Др╕нр╕бр╕бр╕┤р╕Кр╕Кр╕▒р╣Ир╕Щ)
- `WELCOME10` - р╕кр╣Ир╕зр╕Щр╕ер╕Ф 10% р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Гр╕лр╕бр╣И
- `NEWYEAR2025` - р╕кр╣Ир╕зр╕Щр╕ер╕Ф 25% р╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щр╕Ыр╕╡р╣Гр╕лр╕бр╣И

#### Influencer Codes (р╕бр╕╡р╕Др╕нр╕бр╕бр╕┤р╕Кр╕Кр╕▒р╣Ир╕Щ)
- `INFLUENCER15` - р╕кр╣Ир╕зр╕Щр╕ер╕Ф 15%, р╕Др╕нр╕бр╕бр╕┤р╕Кр╕Кр╕▒р╣Ир╕Щ 25%
- `PARTNER20` - р╕кр╣Ир╕зр╕Щр╕ер╕Ф 20%, р╕Др╕нр╕бр╕бр╕┤р╕Кр╕Кр╕▒р╣Ир╕Щ 30%

### 3. р╕гр╕░р╕Ър╕Ър╕Хр╕┤р╕Фр╕Хр╕▓р╕б (Tracking)
- тЬЕ р╕Щр╕▒р╕Ър╕Ир╕│р╕Щр╕зр╕Щр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
- тЬЕ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Др╕нр╕бр╕бр╕┤р╕Кр╕Кр╕▒р╣Ир╕Щр╕Чр╕╕р╕Бр╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣Ир╕бр╕╡р╕Бр╕▓р╕гр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ
- тЬЕ р╕Вр╣Йр╕нр╕бр╕╣р╕е: р╕гр╕▓р╕Др╕▓р╕Ыр╕Бр╕Хр╕┤, р╕гр╕▓р╕Др╕▓р╕лр╕ер╕▒р╕Зр╕кр╣Ир╕зр╕Щр╕ер╕Ф, р╕Др╕нр╕бр╕бр╕┤р╕Кр╕Кр╕▒р╣Ир╕Щ
- тЬЕ р╣Ар╕Бр╣Зр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Бр╕ер╕░ timestamp

## ЁЯЪА р╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕Зр╕гр╕лр╕▒р╕кр╕кр╣Ир╕зр╕Щр╕ер╕Ф

### р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 1: р╕Ьр╣Ир╕▓р╕Щ Browser Console

```javascript
// р╣Ар╕Ыр╕┤р╕Ф Browser Console (F12)

// р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕лр╕▒р╕кр╣Ар╕Фр╕╡р╣Ир╕вр╕з
await createAffiliateCode({
  code: 'MYCODE10',
  ownerId: 'user-123',
  ownerName: 'John Doe',
  discountPercent: 10,      // р╕кр╣Ир╕зр╕Щр╕ер╕Фр╣Гр╕лр╣Йр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й 10%
  commissionPercent: 20,    // р╕Др╕нр╕бр╕бр╕┤р╕Кр╕Кр╕▒р╣Ир╕Щр╣Гр╕лр╣Йр╕Ьр╕╣р╣Йр╣Бр╕Щр╕░р╕Щр╕│ 20%
  maxUsage: 100,            // р╕Ир╕│р╕Бр╕▒р╕Ф 100 р╕Др╕гр╕▒р╣Йр╕З (optional)
  expiresAt: Date.now() + 30*24*60*60*1000  // р╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕ 30 р╕зр╕▒р╕Щ (optional)
});

// р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕лр╕▒р╕кр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
await createExampleAffiliateCodes();
```

### р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 2: р╕Ьр╣Ир╕▓р╕Щ API

```bash
# POST https://YOUR_PROJECT.supabase.co/functions/v1/make-server-6e95bca3/affiliate/create
# Headers: 
#   Content-Type: application/json
#   Authorization: Bearer YOUR_ANON_KEY

curl -X POST https://YOUR_PROJECT.supabase.co/functions/v1/make-server-6e95bca3/affiliate/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ANON_KEY" \
  -d '{
    "code": "MYCODE10",
    "ownerId": "user-123",
    "ownerName": "John Doe",
    "discountPercent": 10,
    "commissionPercent": 20
  }'
```

## ЁЯУК р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е

### Affiliate Code
```typescript
{
  code: string;              // "INFLUENCER10"
  ownerId: string;           // User ID р╕Вр╕нр╕Зр╕Ьр╕╣р╣Йр╣Бр╕Щр╕░р╕Щр╕│
  ownerName: string;         // "John Doe"
  discountPercent: number;   // 10-100
  commissionPercent: number; // 0-100
  usageCount: number;        // р╕Ир╕│р╕Щр╕зр╕Щр╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣Ир╣Гр╕Кр╣Й
  active: boolean;           // р╣Ар╕Ыр╕┤р╕Ф/р╕Ыр╕┤р╕Фр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ
  maxUsage?: number;         // р╕Ир╕│р╕Бр╕▒р╕Фр╕Ир╕│р╕Щр╕зр╕Щр╕Др╕гр╕▒р╣Йр╕З
  expiresAt?: number;        // р╕зр╕▒р╕Щр╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕ (timestamp)
  createdAt: number;         // р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕З
}
```

### Commission Record
```typescript
{
  affiliateCode: string;     // р╕гр╕лр╕▒р╕кр╕Чр╕╡р╣Ир╣Гр╕Кр╣Й
  ownerId: string;           // р╕Ьр╕╣р╣Йр╣Бр╕Щр╕░р╕Щр╕│
  ownerName: string;         
  userId: string;            // р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Чр╕╡р╣Ир╕Лр╕╖р╣Йр╕н
  originalPrice: number;     // р╕гр╕▓р╕Др╕▓р╕Ыр╕Бр╕Хр╕┤
  finalPrice: number;        // р╕гр╕▓р╕Др╕▓р╕лр╕ер╕▒р╕Зр╕кр╣Ир╕зр╕Щр╕ер╕Ф
  discountAmount: number;    // р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щр╕кр╣Ир╕зр╕Щр╕ер╕Ф
  discountPercent: number;   
  commissionPercent: number; 
  commissionAmount: number;  // р╕Др╕нр╕бр╕бр╕┤р╕Кр╕Кр╕▒р╣Ир╕Щр╕Чр╕╡р╣Ир╕Ир╕░р╣Др╕Фр╣Йр╕гр╕▒р╕Ъ
  timestamp: number;         // р╣Ар╕зр╕ер╕▓р╕Чр╕╡р╣Ир╕Чр╕│р╕гр╕▓р╕вр╕Бр╕▓р╕г
}
```

## ЁЯОи UI Components

### 1. `<PromoCodeSection>`
- Input field р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Гр╕кр╣Ир╕гр╕лр╕▒р╕к
- р╕Ыр╕╕р╣Ир╕бр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
- р╣Бр╕кр╕Фр╕З error messages
- р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕гр╕лр╕▒р╕кр╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ
- р╕Ыр╕╕р╣Ир╕бр╕вр╕Бр╣Ар╕ер╕┤р╕Бр╕гр╕лр╕▒р╕к

### 2. `<PriceSummaryWithDiscount>`
- р╣Бр╕кр╕Фр╕Зр╕гр╕▓р╕Др╕▓р╕Ыр╕Бр╕Хр╕┤
- р╣Бр╕кр╕Фр╕Зр╕кр╣Ир╕зр╕Щр╕ер╕Ф (%)
- р╣Бр╕кр╕Фр╕Зр╕гр╕▓р╕Др╕▓р╕лр╕ер╕▒р╕Зр╕лр╕▒р╕Бр╕кр╣Ир╕зр╕Щр╕ер╕Ф
- р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕╣р╣Йр╣Бр╕Щр╕░р╕Щр╕│

## ЁЯУИ р╕Бр╕▓р╕гр╕Фр╕╣р╕гр╕▓р╕вр╕Зр╕▓р╕Щ

### р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕гр╕лр╕▒р╕к
```javascript
// р╕Фр╕╣р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕гр╕лр╕▒р╕кр╕кр╣Ир╕зр╕Щр╕ер╕Ф
const response = await fetch(
  'https://YOUR_PROJECT.supabase.co/functions/v1/make-server-6e95bca3/affiliate/validate',
  {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer YOUR_ANON_KEY'
    },
    body: JSON.stringify({ code: 'INFLUENCER10' })
  }
);
const data = await response.json();
console.log('Usage count:', data.affiliate.usageCount);
```

## ЁЯФТ р╕Бр╕▓р╕гр╕гр╕▒р╕Бр╕йр╕▓р╕Др╕зр╕▓р╕бр╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕в

- тЬЕ Validation р╕Чр╕▒р╣Йр╕З Frontend р╣Бр╕ер╕░ Backend
- тЬЕ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕нр╕▓р╕вр╕╕р╣Бр╕ер╕░р╕Ир╕│р╕Щр╕зр╕Щр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ
- тЬЕ р╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕гр╕лр╕▒р╕кр╕Лр╣Йр╕│р╣Гр╕Щр╕гр╕нр╕Ър╣Ар╕Фр╕╡р╕вр╕з
- тЬЕ Sanitize input р╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щ injection

## ЁЯОп Best Practices

### р╕кр╕│р╕лр╕гр╕▒р╕Ър╕гр╕░р╕Ър╕Ъ
1. р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕кр╣Ир╕зр╕Щр╕ер╕Фр╣Др╕бр╣Ир╣Ар╕Бр╕┤р╕Щ 25% р╣Ар╕Юр╕╖р╣Ир╕нр╕гр╕▒р╕Бр╕йр╕▓р╕Ьр╕ер╕Бр╕│р╣Др╕г
2. р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Др╕нр╕бр╕бр╕┤р╕Кр╕Кр╕▒р╣Ир╕Щр╣Гр╕Щр╕гр╕░р╕Фр╕▒р╕Ър╕Чр╕╡р╣Ир╕Ир╕╣р╕Зр╣Гр╕И (20-30%)
3. р╣Гр╕Кр╣Й maxUsage р╣Ар╕Юр╕╖р╣Ир╕нр╕Др╕зр╕Ър╕Др╕╕р╕бр╕Зр╕Ър╕Ыр╕гр╕░р╕бр╕▓р╕У
4. р╕Хр╕▒р╣Йр╕З expiresAt р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Вр╕Ыр╕гр╣Вр╕бр╕Кр╕▒р╣Ир╕Щр╕гр╕░р╕вр╕░р╕кр╕▒р╣Йр╕Щ

### р╕кр╕│р╕лр╕гр╕▒р╕Ъ Influencer
1. р╣Ар╕ер╕╖р╕нр╕Бр╕гр╕лр╕▒р╕кр╕Чр╕╡р╣Ир╕Ир╕Фр╕Ир╕│р╕Зр╣Ир╕▓р╕в р╣Ар╕Кр╣Ир╕Щ `YOURNAME10`
2. р╣Бр╕Кр╕гр╣Мр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╕Кр╣Ир╕нр╕Зр╕Чр╕▓р╕Зр╕Вр╕нр╕Зр╕Хр╕▒р╕зр╣Ар╕нр╕З
3. р╕Хр╕┤р╕Фр╕Хр╕▓р╕бр╕Ьр╕ер╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Ар╕Ыр╣Зр╕Щр╕Ыр╕гр╕░р╕Ир╕│

## ЁЯУЭ р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

### Scenario 1: р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Гр╕лр╕бр╣И
```
1. р╣Ар╕Вр╣Йр╕▓р╕лр╕Щр╣Йр╕▓ Membership
2. р╣Ар╕ер╕╖р╕нр╕Б Pro Plan (р╕┐129/р╣Ар╕Фр╕╖р╕нр╕Щ)
3. р╣Гр╕кр╣Ир╕гр╕лр╕▒р╕к "WELCOME10"
4. р╣Др╕Фр╣Йр╕кр╣Ир╕зр╕Щр╕ер╕Ф 10% = р╕Ир╣Ир╕▓р╕вр╣Ар╕Юр╕╡р╕вр╕З р╕┐116
```

### Scenario 2: Influencer Marketing
```
1. Influencer р╣Бр╕Кр╕гр╣Мр╕гр╕лр╕▒р╕к "INFLUENCER15"
2. р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Гр╕Кр╣Йр╕гр╕лр╕▒р╕кр╕Лр╕╖р╣Йр╕н Pro Plan р╕┐129
3. р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Др╕Фр╣Йр╕кр╣Ир╕зр╕Щр╕ер╕Ф 15% = р╕Ир╣Ир╕▓р╕в р╕┐110
4. Influencer р╣Др╕Фр╣Йр╕Др╕нр╕бр╕бр╕┤р╕Кр╕Кр╕▒р╣Ир╕Щ 25% р╕Ир╕▓р╕Б р╕┐110 = р╕┐27.50
```

## ЁЯЪж API Endpoints

### POST `/affiliate/validate`
р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕Вр╕нр╕Зр╕гр╕лр╕▒р╕к

**Request:**
```json
{
  "code": "INFLUENCER10"
}
```

**Response (Success):**
```json
{
  "success": true,
  "affiliate": {
    "code": "INFLUENCER10",
    "ownerId": "user-123",
    "ownerName": "John Doe",
    "discountPercent": 15,
    "commissionPercent": 25,
    "usageCount": 42,
    "active": true
  }
}
```

**Response (Error):**
```json
{
  "success": false,
  "message": "р╕гр╕лр╕▒р╕кр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕лр╕гр╕╖р╕нр╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕"
}
```

### POST `/affiliate/create`
р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕лр╕▒р╕кр╣Гр╕лр╕бр╣И

**Request:**
```json
{
  "code": "MYCODE10",
  "ownerId": "user-123",
  "ownerName": "John Doe",
  "discountPercent": 10,
  "commissionPercent": 20,
  "maxUsage": 100,
  "expiresAt": 1735689600000
}
```

### POST `/membership`
р╕нр╕▒р╕Юр╣Ар╕Фр╕Ч Membership (р╕Юр╕гр╣Йр╕нр╕бр╕Хр╕┤р╕Фр╕Хр╕▓р╕бр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕гр╕лр╕▒р╕к)

**Request:**
```json
{
  "membership": { /* membership object */ },
  "affiliate": {
    "code": "INFLUENCER10",
    "ownerId": "user-123",
    "ownerName": "John Doe",
    "originalPrice": 129,
    "finalPrice": 110,
    "discountAmount": 19,
    "discountPercent": 15,
    "commissionPercent": 25
  }
}
```

## ЁЯОЙ р╕кр╕гр╕╕р╕Ы

р╕гр╕░р╕Ър╕Ъ Affiliate/Referral Code р╕Щр╕╡р╣Йр╕Кр╣Ир╕зр╕вр╣Гр╕лр╣Й:
- **р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й** р╣Др╕Фр╣Йр╕кр╣Ир╕зр╕Щр╕ер╕Фр╣Бр╕ер╕░р╕гр╕╣р╣Йр╕кр╕╢р╕Бр╕Др╕╕р╣Йр╕бр╕Др╣Ир╕▓
- **Influencer** р╣Др╕Фр╣Йр╕гр╕▓р╕вр╣Др╕Фр╣Йр╣Ар╕кр╕гр╕┤р╕бр╕Ир╕▓р╕Бр╕Бр╕▓р╕гр╣Бр╕Щр╕░р╕Щр╕│  
- **р╕Шр╕╕р╕гр╕Бр╕┤р╕И** р╣Ар╕Хр╕┤р╕Ър╣Вр╕Хр╕Ьр╣Ир╕▓р╕Щ Word-of-Mouth Marketing

р╕кр╕гр╣Йр╕▓р╕З win-win-win situation р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Чр╕╕р╕Бр╕Эр╣Ир╕▓р╕в! ЁЯЪА
