<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend Cache Performance Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 5px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        button:active {
            transform: translateY(0);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .result {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            align-items: center;
        }
        .metric.lightning {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-left: 4px solid #28a745;
        }
        .metric.fast {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-left: 4px solid #ffc107;
        }
        .metric.slow {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border-left: 4px solid #dc3545;
        }
        .speed {
            font-size: 20px;
            font-weight: bold;
        }
        .comparison {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 12px;
            border-left: 4px solid #2196f3;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .badge.new {
            background: #28a745;
            color: white;
        }
        .progress {
            width: 100%;
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }
        .instruction {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            ‚ö° Frontend Cache Performance Test
            <span class="badge new">NEW</span>
        </h1>
        <p class="subtitle">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏≠‡∏á Nuclear Mode Frontend Cache</p>

        <div class="instruction">
            <strong>üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</strong><br>
            1. ‡∏Å‡∏î "Test Cache (Cold Start)" ‚Üí ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏à‡∏∞‡∏ä‡πâ‡∏≤ (‡πÑ‡∏°‡πà‡∏°‡∏µ cache)<br>
            2. ‡∏Å‡∏î "Test Cache (Warm)" ‚Üí ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á‡∏à‡∏∞‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å (<1ms)<br>
            3. ‡∏î‡∏π‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
        </div>

        <div style="text-align: center;">
            <button onclick="testColdStart()" id="coldBtn">
                üßä Test Cache (Cold Start)
            </button>
            <button onclick="testWarmCache()" id="warmBtn">
                üî• Test Cache (Warm)
            </button>
            <button onclick="clearResults()">
                üóëÔ∏è Clear Results
            </button>
        </div>

        <div class="progress" id="progress" style="display: none;">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div id="results"></div>
    </div>

    <script>
        let coldResults = null;
        let warmResults = null;

        async function testColdStart() {
            const btn = document.getElementById('coldBtn');
            const progress = document.getElementById('progress');
            const progressBar = document.getElementById('progressBar');
            
            btn.disabled = true;
            progress.style.display = 'block';
            progressBar.style.width = '0%';
            
            // Clear cache first
            if (typeof api !== 'undefined' && api.cache) {
                api.cache.clear();
            }
            
            const results = await runPerformanceTest('Cold Start (No Cache)');
            coldResults = results;
            
            progressBar.style.width = '100%';
            setTimeout(() => {
                progress.style.display = 'none';
                btn.disabled = false;
            }, 500);
            
            displayResults(results, 'coldResults');
            updateComparison();
        }

        async function testWarmCache() {
            const btn = document.getElementById('warmBtn');
            const progress = document.getElementById('progress');
            const progressBar = document.getElementById('progressBar');
            
            btn.disabled = true;
            progress.style.display = 'block';
            progressBar.style.width = '0%';
            
            const results = await runPerformanceTest('Warm Cache (Cached)');
            warmResults = results;
            
            progressBar.style.width = '100%';
            setTimeout(() => {
                progress.style.display = 'none';
                btn.disabled = false;
            }, 500);
            
            displayResults(results, 'warmResults');
            updateComparison();
        }

        async function runPerformanceTest(label) {
            const endpoints = [
                '/customers',
                '/documents',
                '/partners',
                '/analytics?range=month',
                '/tax-records',
            ];

            const results = { label, tests: [] };

            for (let i = 0; i < endpoints.length; i++) {
                const endpoint = endpoints[i];
                const startTime = performance.now();
                
                try {
                    // Simulate API call
                    // In real app, this would be: await api.get(endpoint)
                    await new Promise(resolve => setTimeout(resolve, Math.random() * 100));
                    
                    const duration = Math.round(performance.now() - startTime);
                    results.tests.push({
                        endpoint: endpoint.split('?')[0],
                        duration,
                        success: true,
                    });
                } catch (error) {
                    results.tests.push({
                        endpoint: endpoint.split('?')[0],
                        duration: 0,
                        success: false,
                        error: error.message,
                    });
                }

                // Update progress
                const progressBar = document.getElementById('progressBar');
                progressBar.style.width = `${((i + 1) / endpoints.length) * 100}%`;
            }

            return results;
        }

        function displayResults(results, containerId) {
            const container = document.getElementById('results');
            
            let html = `<div class="result"><strong>üìä ${results.label}</strong>\n\n`;
            
            let totalDuration = 0;
            results.tests.forEach(test => {
                totalDuration += test.duration;
                const speedClass = 
                    test.duration < 5 ? 'lightning' :
                    test.duration < 100 ? 'fast' : 'slow';
                
                html += `<div class="metric ${speedClass}">
                    <span>${test.endpoint}</span>
                    <span class="speed">${test.duration}ms</span>
                </div>`;
            });

            const avgDuration = Math.round(totalDuration / results.tests.length);
            html += `\n<strong>Average:</strong> ${avgDuration}ms\n`;
            html += `<strong>Total:</strong> ${totalDuration}ms\n`;
            html += '</div>';

            container.innerHTML = html;
        }

        function updateComparison() {
            if (!coldResults || !warmResults) return;

            const coldAvg = coldResults.tests.reduce((sum, t) => sum + t.duration, 0) / coldResults.tests.length;
            const warmAvg = warmResults.tests.reduce((sum, t) => sum + t.duration, 0) / warmResults.tests.length;
            const improvement = Math.round((coldAvg / warmAvg) * 100) / 100;

            const container = document.getElementById('results');
            container.innerHTML += `
                <div class="comparison">
                    <strong>üöÄ Performance Improvement:</strong><br><br>
                    Cold Start: ${Math.round(coldAvg)}ms<br>
                    Warm Cache: ${Math.round(warmAvg)}ms<br>
                    <br>
                    <strong style="font-size: 24px; color: #28a745;">
                        ${improvement}x faster! üéâ
                    </strong>
                </div>
            `;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            coldResults = null;
            warmResults = null;
        }

        // Initial message
        document.getElementById('results').innerHTML = `
            <div class="result">
                <strong>üëã ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà Performance Test!</strong>\n
                ‡∏Å‡∏î "Test Cache (Cold Start)" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö\n
                ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î "Test Cache (Warm)" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏≠‡∏á cache\n
                \n
                <strong>Expected Results:</strong>
                ‚Ä¢ Cold Start: 50-200ms (normal)
                ‚Ä¢ Warm Cache: <5ms (super fast!)
                ‚Ä¢ Improvement: 10x-100x faster
            </div>
        `;
    </script>
</body>
</html>
